<!DOCTYPE html>
<html lang="en">

<head>
	<title>Ewan Green</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8" />
	<meta property="og:url" content="https://ewan.horse/">
	<meta name="twitter:url" content="https://ewan.horse/">
	<meta property="og:title" content="Ewan Green">
	<meta name="twitter:title" content="Ewan Green">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="prism.css">
	<link rel="stylesheet" href="prism-theme.css">
	<link rel='icon' href='resource/favicon.png' type='image/png'>
	</style>
</head>

<body>
	<div class="popup" id="popupDiscord">
		<div display="flex" flex-direction="row">
			<p class="fetchDependent uiText noSelect">Discord:&ensp;</p><code
				class="fetchDependent uiText noSelect contactDestination"></code>
		</div>
		<p class="fetchError uiText noSelect"></p>
		<div class="spinner"></div>
	</div>
	<div class="popup" id="popupSlack">
		<div display="flex" flex-direction="row">
			<p class="fetchDependent uiText noSelect">Slack:&ensp;</p><code
				class="fetchDependent uiText noSelect contactDestination"></code>
		</div>
		<p class="fetchError uiText noSelect"></p>
		<div class="spinner"></div>
	</div>
	<div class="popup" id="popupEmail">
		<div display="flex" flex-direction="row">
			<p class="fetchDependent uiText noSelect">Email:&ensp;</p><code
				class="fetchDependent uiText noSelect contactDestination"></code>
		</div>
		<p class="fetchError uiText noSelect"></p>
		<div class="spinner"></div>
	</div>

	<div class="content" id="portfolioPage">
		<div class="gistDropdown">
			<pre class="codeContainer language-cpp"><code class="language-cpp">
				// Title bar customization with Qt - Ewan Green 2022

#include "TitleBar.h"

#include <QOperatingSystemVersion>
#include <QtDebug>

#if defined(Q_OS_WINDOWS)
#include <Windows.h>

void customizeNativeTitleBar(WId w, const TitleBarColors &colors) noexcept {
  if (QOperatingSystemVersion::current() >=
      QOperatingSystemVersion::Windows10) {
    static ULONG osBuildNumber = *reinterpret_cast<DWORD *>(0x7FFE0000 + 0x260);
    // https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/ns-ntddk-kuser_shared_data#syntax
    // Member "NtMinorVersion" of _KUSER_SHARED_DATA. Address is reserved by the
    // OS. Alternatively, the build number can be acquired through GetVersionEx
    // or RtlGetVersion, but those require a proper app manifest.

    auto qColorToColorRef = [](const QColor &col) -> COLORREF {
      return (col.red() | col.green() << 8 | col.blue() << 16);
    };

    enum {
      NoDwm,
      NoDwmSetWindowAttribute,
      NoBackgroundBrush,
      NoDarkMode,
      NoBorderColor,
      NoCaptionColor,
      NoTextColor
    };

    static auto error = [](int i) {
      static QHash<const int, const char *> errorTable = {
          {NoDwm, "DWM library not found."},
          {NoDwmSetWindowAttribute, "DwmSetWindowAttribute not found."},
          {NoDarkMode, "Unable to set immersive dark mode attribute."},
          {NoBackgroundBrush, "Unable to set background brush attribute."},
          {NoBorderColor, "Unable to set window border color attribute."},
          {NoCaptionColor, "Unable to set window caption color attribute."},
          {NoTextColor, "Unable to set window text color attribute."},
      };
      static QVector<int> alreadyErrored;
      if (!alreadyErrored.contains(i)) {
        qWarning() << "Error while setting title bar attributes: "
                   << QObject::tr(errorTable.find(i).value());
        alreadyErrored.push_back(i);
      }
    };

    // We are loading the library dynamically and not using the dwmapi header
    // because the values we use in the DWMWINDOWATTRIBUTE enum are only present
    // in very new versions of the Windows SDK, which is rarely in use by Qt
    // apps. If you are using SDK version 22000 or later, you can include the
    // header & link dwmapi statically and save a lot of code.
    static auto hdwmapi = LoadLibraryW(L"dwmapi.dll");
    if (!hdwmapi) {
      error(NoDwm);
      return;
    }

    // https://learn.microsoft.com/en-us/windows/win32/api/dwmapi/ne-dwmapi-dwmwindowattribute
    typedef int(WINAPI * DWMSETWINDOWATTRIBUTE)(
        HWND hwnd, DWORD dwAttribute, LPCVOID pvAttribute,
        DWORD cbAttribute);  // typedef is required here thanks to WINAPI
                             // keyword (__stdcall)
    static auto DwmSetWindowAttribute = reinterpret_cast<DWMSETWINDOWATTRIBUTE>(
        GetProcAddress(hdwmapi, "DwmSetWindowAttribute"));
    if (!DwmSetWindowAttribute) {
      error(NoDwmSetWindowAttribute);
      return;
    }

    auto hwnd = reinterpret_cast<HWND>(w);

    quint32 darkTitleBar = colors.isDark;
    if (FAILED(DwmSetWindowAttribute(
            hwnd,
            (osBuildNumber >=
             18985) /* 18985 is a build of Windows 10 that presumably
                   displaced the attribute in the enum*/
                ? 20
                : 19 /*DWMWINDOWATTRIBUTE::DWMWA_USE_IMMERSIVE_DARK_MODE*/,
            &darkTitleBar, sizeof(quint32))))
      error(NoDarkMode);

    if (osBuildNumber >= 22000) {
      // 22000 is the first build of Windows 11
      if (colors.brush != TitleBarColors::Default) {
        if (FAILED(DwmSetWindowAttribute(
                hwnd, 38 /*DWMWINDOWATTRIBUTE::DWMWA_SYSTEMBACKDROP_TYPE*/,
                &colors.brush, sizeof(colors.brush))))
          error(NoBackgroundBrush);
      }

      if (colors.border.isValid()) {
        COLORREF b = qColorToColorRef(colors.border);
        if (FAILED(DwmSetWindowAttribute(
                hwnd, 34 /*DWMWINDOWATTRIBUTE::DWMWA_BORDER_COLOR*/, &b,
                sizeof(b))))
          error(NoBorderColor);
      }

      if (colors.caption.isValid()) {
        COLORREF c = qColorToColorRef(colors.caption);
        if (FAILED(DwmSetWindowAttribute(
                hwnd, 35 /*DWMWINDOWATTRIBUTE::DWMWA_CAPTION_COLOR*/, &c,
                sizeof(c))))
          error(NoCaptionColor);
      }

      if (colors.text.isValid()) {
        COLORREF t = qColorToColorRef(colors.text);
        if (FAILED(DwmSetWindowAttribute(
                hwnd, 36 /*DWMWINDOWATTRIBUTE::DWMWA_TEXT_COLOR*/, &t,
                sizeof(t))))
          error(NoTextColor);
      }
    }
  }
}
#endif

// macOS implementation must go in its own file because it uses Objective C
// syntax. See TitleBarMacOs.mm (must be called something other than this file,
// even if the extension changes -- some build systems will overwrite the
// resulting object files if they are named the same.)

void setTitleBar(QWidget *w, const TitleBarColors &colors) noexcept {
  if (w->windowHandle() == nullptr)
    return;  // Widget is not top-level, and therefore does not have borders
  if (w->property("HasStyledTitleBar") == true)
    return;  // No need to do this multiple times
#if defined(Q_OS_WINDOWS) || defined(Q_OS_MACOS)
  customizeNativeTitleBar(w->window()->winId(), colors);
#else
  qWarning() << QObject::tr(
      "Title bar customization is not supported on this platform.");
#endif
  w->setProperty("HasStyledTitleBar", true);
}

				};
			</code></pre>
		</div>
	</div>
	<div class="content" id="contactPage">
		<p class="subtitle uiText" id="contactHeader">Get in touch</p>
		<hr>
		<div display="flex" class="contactContainer">
			<a class="contactButton" href="https://github.com/EwanGreen4" target="_blank" rel="noopener noreferrer">
				<p class="contactIcon">0</p>
				<p class="contactText">GitHub</p>
			</a>
			<a class="contactButton" callback="getContactData('Discord')">
				<p class="contactIcon">1</p>
				<p class="contactText">Discord</p>
			</a>
			<a class="contactButton" callback="getContactData('Slack')">
				<p class="contactIcon">2</p>
				<p class="contactText">Slack</p>
			</a>
			<a class="contactButton" href="https://fosstodon.org/@ewang" target="_blank" rel="noopener noreferrer">
				<p class="contactIcon">3</p>
				<p class="contactText">Mastodon</p>
			</a>
			<a class="contactButton" href="https://cohost.org/ewan" target="_blank" rel="noopener noreferrer">
				<p class="contactIcon">4</p>
				<p class="contactText">cohost</p>
			</a>
			<a class="contactButton" callback="getContactData('Email')">
				<p class="contactIcon">5</p>
				<p class="contactText">Email</p>
			</a>
		</div>
	</div>

	<div class="dynamicHeader">
		<img class="circularImage noDock autoAnimate" src="resource/ewan.png" width="128pt" height="128pt"
			draggable="false">

		<p class="subtitle onlyDock uiText autoAnimate" id="smallTitle">Ewan Green</p>
		<div id="divInnerContent" display="flex">

			<p id="title" class="noDock uiText autoAnimate">Ewan Green</p>
			<p id="mainCaption" class="caption noDock uiText autoAnimate">Software Engineer</p>

			<div class="navButtonContainer autoAnimate" id="mainNavButton" defaultSelection="0"
				onload="createNavButton(this)">
				<div class="navButton" id="summaryNavButton" callback="Navigation.showSummary()">Summary</div>
				<div class="navButton" id="portfolioNavButton" callback="Navigation.showPortfolio()">Portfolio</div>
				<div class="navButton" id="contactNavButton" callback="Navigation.showContact()">Contact</div>
			</div>
		</div>
	</div>

	<!-- 	<div id="popupDiscord" class="popup">
		<h3 class="popupText" align="center">Discord:&ensp;<code
				onclick="selectElementText(document.getElementById('discordText'))"
				id="discordText">Ewan Green#1526</code></h3>
		<div class="divButtons" align="center">
			<button vertical-align="center" onclick="hidePopup('popupDiscord')"><i
					class="fas fa-times"></i>&ensp;Close</button>
		</div>
	</div>
	<div id="popupLicense" class="popup">
		<h3 class="popupText" align="center">This website uses third-party assets.</h3>
		<p class="popupText" align="center">
			<a href="https://fontawesome.com" target="_blank" rel="noopener noreferrer">FontAwesome
				5.15.3</a>&ensp;-&ensp;<a href="https://fontawesome.com/license/free" target="_blank"
				rel="noopener noreferrer">Custom License</a></br>
			<a href="https://fonts.adobe.com/fonts/source-sans" target="_blank" rel="noopener noreferrer">Source Sans
				Pro</a>&ensp;-&ensp;<a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL"
				target="_blank" rel="noopener noreferrer">Open Font License</a><br>
			<a href="https://design.ubuntu.com/font/" target="_blank" rel="noopener noreferrer">Ubuntu
				Mono</a>&ensp;-&ensp;<a href="https://ubuntu.com/legal/font-licence" target="_blank"
				rel="noopener noreferrer">Ubuntu Font Licence</a>
		</p>
		<div class="divButtons" align="center">
			<button onclick="hidePopup('popupLicense')"><i class="fas fa-times"></i>&ensp;Close</button>
		</div>
	</div>
-->
	<!-- 	<div id="shadeBehindPopup"></div>
 -->
</body>
<script type="module" src="script.js"></script>
<script src="prism.js"></script>

</html>